<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Système de Gestion des Tâches</title>
    
</head>
<body>
    <h1>Système de Gestion des Tâches</h1>
    
    <div id="formulaire-tache">
        <h2>Ajouter une nouvelle tâche</h2>
        <form id="form-ajout-tache">
            <div class="groupe-formulaire">
                <label>ID généré automatiquement:</label>
                <div id="id-genere">1</div>
            </div>
            
            <div class="groupe-formulaire">
                <label for="nom-tache">Tâche principale:</label>
                <input type="text" id="nom-tache" required placeholder="Ex: Analyse des besoins">
            </div>
            
            <div class="groupe-formulaire">
                <label for="duree-tache">Durée (jours):</label>
                <input type="number" id="duree-tache" min="1" required placeholder="Ex: 3">
            </div>
            
            <div class="groupe-formulaire">
                <label for="precedente-tache">Prédécesseur(s):</label>
                <select id="precedente-tache" multiple>
                    <option value="">Aucun</option>
                </select>
                <small>Ctrl+Clic pour sélectionner plusieurs</small>
            </div>
            
            <div class="groupe-formulaire">
                <label for="commentaire-tache">Commentaire:</label>
                <textarea id="commentaire-tache" placeholder="Description..."></textarea>
            </div>
            
            <button type="submit">Ajouter la tâche</button>
        </form>
    </div>
    
    <div id="conteneur-taches">
        <h2>Tableau des tâches</h2>
        <table id="tableau-taches">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tâche principale</th>
                    <th>Durée</th>
                    <th>Prédécesseur(s)</th>
                    <th>Commentaire</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="liste-taches">
                <!-- Le tableau commencera vide -->
            </tbody>
        </table>
    </div>

    <script>
        // Tableau pour stocker les tâches - COMMENCE VIDE
        var taches = [];
        var prochainId = 1;

        // Récupérer les éléments HTML
        var formulaire = document.getElementById('form-ajout-tache');
        var idGenereDiv = document.getElementById('id-genere');
        var nomInput = document.getElementById('nom-tache');
        var dureeInput = document.getElementById('duree-tache');
        var predecesseurSelect = document.getElementById('precedente-tache');
        var commentaireInput = document.getElementById('commentaire-tache');
        var listeTaches = document.getElementById('liste-taches');

        // Fonction pour trouver un ID disponible
        function trouverIdDisponible() {
            return prochainId;
        }

        // Fonction pour mettre à jour l'ID généré
        function mettreAJourId() {
            idGenereDiv.textContent = trouverIdDisponible();
        }

        // Fonction pour mettre à jour la liste des prédécesseurs
        function mettreAJourPredecesseurs() {
            predecesseurSelect.innerHTML = '<option value="">Aucun</option>';
            
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                var option = document.createElement('option');
                option.value = tache.id;
                option.textContent = tache.id + ' - ' + tache.nom;
                predecesseurSelect.appendChild(option);
            }
        }

        // Fonction pour afficher toutes les tâches
        function afficherTaches() {
            listeTaches.innerHTML = '';
            
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                var ligne = document.createElement('tr');
                
                // Préparer l'affichage des prédécesseurs
                var predecesseursAffiches = '—';
                if (tache.precedentes && tache.precedentes.length > 0) {
                    predecesseursAffiches = tache.precedentes.join(', ');
                }
                
                ligne.innerHTML = '<td>' + tache.id + '</td>' +
                                 '<td>' + tache.nom + '</td>' +
                                 '<td><span class="badge-duree">' + tache.duree + '</span></td>' +
                                 '<td>' + predecesseursAffiches + '</td>' +
                                 '<td>' + (tache.commentaire || '') + '</td>' +
                                 '<td><button onclick="supprimerTache(' + tache.id + ')">Supprimer</button></td>';
                
                listeTaches.appendChild(ligne);
            }
            
            mettreAJourPredecesseurs();
            mettreAJourId();
        }

        // Fonction pour ajouter une tâche
        function ajouterTache(nom, duree, precedentes, commentaire) {
            var id = trouverIdDisponible();
            
            var nouvelleTache = {
                id: id,
                nom: nom,
                duree: duree,
                precedentes: precedentes || [],
                commentaire: commentaire || ''
            };
            
            taches.push(nouvelleTache);
            prochainId++;
            
            afficherTaches();
        }

        // Fonction pour supprimer une tâche
        function supprimerTache(idTache) {
            // Vérifier si la tâche est utilisée comme prédécesseur
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                if (tache.precedentes && tache.precedentes.includes(idTache)) {
                    alert('Cette tâche ne peut pas être supprimée car elle est utilisée comme prédécesseur.');
                    return;
                }
            }
            
            // Supprimer la tâche
            var nouvellesTaches = [];
            for (var i = 0; i < taches.length; i++) {
                if (taches[i].id !== idTache) {
                    nouvellesTaches.push(taches[i]);
                }
            }
            taches = nouvellesTaches;
            
            afficherTaches();
        }

        // Gérer la soumission du formulaire
        formulaire.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Récupérer les prédécesseurs sélectionnés
            var predecesseurs = [];
            for (var i = 0; i < predecesseurSelect.options.length; i++) {
                var option = predecesseurSelect.options[i];
                if (option.selected && option.value !== "") {
                    predecesseurs.push(parseInt(option.value));
                }
            }
            
            var nom = nomInput.value.trim();
            var duree = parseInt(dureeInput.value);
            var commentaire = commentaireInput.value.trim();
            
            // Validation simple
            if (nom === '') {
                alert('Veuillez saisir un nom pour la tâche.');
                return;
            }
            
            if (isNaN(duree) || duree < 1) {
                alert('La durée doit être d\'au moins 1 jour.');
                return;
            }
            
            ajouterTache(nom, duree, predecesseurs, commentaire);
            
            // Réinitialiser le formulaire
            nomInput.value = '';
            dureeInput.value = '';
            commentaireInput.value = '';
            predecesseurSelect.selectedIndex = 0;
        });

        
         afficherTaches();
        

      
    </script>
</body>
</html>
