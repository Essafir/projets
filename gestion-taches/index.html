<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Gestion des Tâches</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f5f5f5; padding: 20px; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        h2 { color: #34495e; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        #formulaire-tache, #conteneur-taches { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px; }
        #form-ajout-tache { display: grid; gap: 20px; }
        .groupe-formulaire { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; color: #2c3e50; }
        input, select, textarea { padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3498db; }
        textarea { resize: vertical; min-height: 80px; }
        small { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; }
        #id-genere { background: #ecf0f1; padding: 12px; border-radius: 6px; font-weight: bold; color: #2c3e50; border: 2px dashed #bdc3c7; }
        button { background: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; }
        button:hover { background: #2980b9; }
        #tableau-taches { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #tableau-taches th { background: #34495e; color: white; padding: 15px; text-align: left; font-weight: 600; }
        #tableau-taches td { padding: 15px; border-bottom: 1px solid #ecf0f1; }
        #tableau-taches tr:hover { background-color: #f8f9fa; }
        #tableau-taches td:first-child { font-weight: bold; color: #e74c3c; text-align: center; }
        #tableau-taches td:nth-child(3) { text-align: center; font-weight: bold; color: #27ae60; }
        #tableau-taches td:nth-child(4) { text-align: center; }
        #tableau-taches td:last-child { text-align: center; }
        #tableau-taches button { background: #e74c3c; padding: 8px 16px; font-size: 14px; }
        #tableau-taches button:hover { background: #c0392b; }
        .badge-duree { background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>Système de Gestion des Tâches</h1>
    
    <div id="formulaire-tache">
        <h2>Ajouter une nouvelle tâche</h2>
        <form id="form-ajout-tache">
            <div class="groupe-formulaire">
                <label>ID généré automatiquement:</label>
                <div id="id-genere">1</div>
            </div>
            
            <div class="groupe-formulaire">
                <label for="nom-tache">Tâche principale:</label>
                <input type="text" id="nom-tache" required placeholder="Ex: Analyse des besoins">
            </div>
            
            <div class="groupe-formulaire">
                <label for="duree-tache">Durée (jours):</label>
                <input type="number" id="duree-tache" min="1" required placeholder="Ex: 3">
            </div>
            
            <div class="groupe-formulaire">
                <label for="precedente-tache">Prédécesseur(s):</label>
                <select id="precedente-tache" multiple>
                    <option value="">Aucun</option>
                </select>
                <small>Ctrl+Clic pour sélectionner plusieurs</small>
            </div>
            
            <div class="groupe-formulaire">
                <label for="commentaire-tache">Commentaire:</label>
                <textarea id="commentaire-tache" placeholder="Description..."></textarea>
            </div>
            
            <button type="submit">Ajouter la tâche</button>
        </form>
    </div>
    
    <div id="conteneur-taches">
        <h2>Tableau des tâches</h2>
        <table id="tableau-taches">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tâche principale</th>
                    <th>Durée</th>
                    <th>Prédécesseur(s)</th>
                    <th>Commentaire</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="liste-taches">
                <!-- Le tableau commencera vide -->
            </tbody>
        </table>
    </div>

    <script>
        // Tableau pour stocker les tâches - COMMENCE VIDE
        var taches = [];
        var prochainId = 1;

        // Récupérer les éléments HTML
        var formulaire = document.getElementById('form-ajout-tache');
        var idGenereDiv = document.getElementById('id-genere');
        var nomInput = document.getElementById('nom-tache');
        var dureeInput = document.getElementById('duree-tache');
        var predecesseurSelect = document.getElementById('precedente-tache');
        var commentaireInput = document.getElementById('commentaire-tache');
        var listeTaches = document.getElementById('liste-taches');

        // Fonction pour trouver un ID disponible
        function trouverIdDisponible() {
            return prochainId;
        }

        // Fonction pour mettre à jour l'ID généré
        function mettreAJourId() {
            idGenereDiv.textContent = trouverIdDisponible();
        }

        // Fonction pour mettre à jour la liste des prédécesseurs
        function mettreAJourPredecesseurs() {
            predecesseurSelect.innerHTML = '<option value="">Aucun</option>';
            
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                var option = document.createElement('option');
                option.value = tache.id;
                option.textContent = tache.id + ' - ' + tache.nom;
                predecesseurSelect.appendChild(option);
            }
        }

        // Fonction pour afficher toutes les tâches
        function afficherTaches() {
            listeTaches.innerHTML = '';
            
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                var ligne = document.createElement('tr');
                
                // Préparer l'affichage des prédécesseurs
                var predecesseursAffiches = '—';
                if (tache.precedentes && tache.precedentes.length > 0) {
                    predecesseursAffiches = tache.precedentes.join(', ');
                }
                
                ligne.innerHTML = '<td>' + tache.id + '</td>' +
                                 '<td>' + tache.nom + '</td>' +
                                 '<td><span class="badge-duree">' + tache.duree + '</span></td>' +
                                 '<td>' + predecesseursAffiches + '</td>' +
                                 '<td>' + (tache.commentaire || '') + '</td>' +
                                 '<td><button onclick="supprimerTache(' + tache.id + ')">Supprimer</button></td>';
                
                listeTaches.appendChild(ligne);
            }
            
            mettreAJourPredecesseurs();
            mettreAJourId();
        }

        // Fonction pour ajouter une tâche
        function ajouterTache(nom, duree, precedentes, commentaire) {
            var id = trouverIdDisponible();
            
            var nouvelleTache = {
                id: id,
                nom: nom,
                duree: duree,
                precedentes: precedentes || [],
                commentaire: commentaire || ''
            };
            
            taches.push(nouvelleTache);
            prochainId++;
            
            afficherTaches();
        }

        // Fonction pour supprimer une tâche
        function supprimerTache(idTache) {
            // Vérifier si la tâche est utilisée comme prédécesseur
            for (var i = 0; i < taches.length; i++) {
                var tache = taches[i];
                if (tache.precedentes && tache.precedentes.includes(idTache)) {
                    alert('Cette tâche ne peut pas être supprimée car elle est utilisée comme prédécesseur.');
                    return;
                }
            }
            
            // Supprimer la tâche
            var nouvellesTaches = [];
            for (var i = 0; i < taches.length; i++) {
                if (taches[i].id !== idTache) {
                    nouvellesTaches.push(taches[i]);
                }
            }
            taches = nouvellesTaches;
            
            afficherTaches();
        }

        // Gérer la soumission du formulaire
        formulaire.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Récupérer les prédécesseurs sélectionnés
            var predecesseurs = [];
            for (var i = 0; i < predecesseurSelect.options.length; i++) {
                var option = predecesseurSelect.options[i];
                if (option.selected && option.value !== "") {
                    predecesseurs.push(parseInt(option.value));
                }
            }
            
            var nom = nomInput.value.trim();
            var duree = parseInt(dureeInput.value);
            var commentaire = commentaireInput.value.trim();
            
            // Validation simple
            if (nom === '') {
                alert('Veuillez saisir un nom pour la tâche.');
                return;
            }
            
            if (isNaN(duree) || duree < 1) {
                alert('La durée doit être d\'au moins 1 jour.');
                return;
            }
            
            ajouterTache(nom, duree, predecesseurs, commentaire);
            
            // Réinitialiser le formulaire
            nomInput.value = '';
            dureeInput.value = '';
            commentaireInput.value = '';
            predecesseurSelect.selectedIndex = 0;
        });

        
         afficherTaches();
        

      
    </script>
</body>
</html>
